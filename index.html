<!DOCTYPE html>
<!-- temporary html/css code stolen from socket.io's example. 
  this build is only to test out the server


js is also temporary, also very terribly written.
  -->
<meta charset="utf-8" />
<title>WebSocket Test</title>
<script language="javascript" type="text/javascript">

var name = "";



function packMessage(msg) {
  return JSON.stringify({type:'message',name: name,body: msg})
//  '{"type":"message","name":"'+name+'","body":"' + encodeURI(msg) + '"}';
}
function packOnline(bool) {
  return JSON.stringify({type:'online',name: name})
//  return '{"type":"online","name":"' + encodeURI(name) + '"}'
}

var wsUri = "ws://localhost:1337";
var socket = new WebSocket(wsUri);

socket.onopen = function() {
  name = prompt("Please enter your name", "Name");
  socket.send(packOnline(true));
}
socket.onmessage = function(resp) {
  if (decodeURI(JSON.parse(resp.data).type) ==="online") {
    var ul = document.getElementById("messages");
    var li = document.createElement("li");
    li.appendChild(document.createTextNode(decodeURI(JSON.parse(resp.data).type) +": " + decodeURI(JSON.parse(resp.data).name)));
    ul.appendChild(li);
  } else {
  var ul = document.getElementById("messages");
  var li = document.createElement("li");
  li.appendChild(document.createTextNode(decodeURI(JSON.parse(resp.data).name) +": " + decodeURI(JSON.parse(resp.data).body)));
  ul.appendChild(li);
}
}

socket.onclose = function() {
  alert('closed');
}
function sendMsg(msg) {

  socket.send(packMessage(msg));
}





</script>
<head>
    <title>Chat</title>
    <style>
      * { margin: 0; padding: 0; box-sizing: border-box; }
      body { font: 13px Helvetica, Arial; }

      input { border: 0; padding: 10px; width: 90%; margin-right: .5%; }
      button { width: 9%; background: rgb(130, 224, 255); border: none; padding: 10px; }
      #messages { list-style-type: none; margin: 0; padding: 0; }
      #messages li { padding: 5px 10px; }
      #messages li:nth-child(odd) { background: #eee; }
    </style>
  </head>
  <body>
    <ul id="messages"></ul>
      <input id="m" autocomplete="off"/><button onclick="sendMsg(document.getElementById('m').value);">Send</button>
  </body>
